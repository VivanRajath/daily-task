<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Daily Focus Spinner</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      padding: 20px;
      text-align: center;
    }

    h1 {
      margin-bottom: 10px;
    }

    .spinner {
      width: 300px;
      height: 300px;
      border-radius: 50%;
      border: 10px solid #22c55e;
      margin: 20px auto;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      transition: transform 3s ease-out;
      background: #020617;
    }

    button {
      padding: 10px 20px;
      background: #22c55e;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
    }

    button:hover {
      background: #16a34a;
    }

    .tracker {
      margin-top: 30px;
    }

    input {
      padding: 8px;
      width: 60px;
      text-align: center;
      margin-left: 10px;
    }

    .charts {
      margin-top: 40px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>

<body>

<h1>Daily Goal Spinner</h1>
<p>Spin once. Commit fully.</p>

<div class="spinner" id="spinner">
  Click Spin
</div>

<button onclick="spin()">Spin</button>

<div class="tracker">
  <h3>Log Productivity</h3>
  <p id="selectedGoal">Goal: —</p>
  <label>
    Productivity (1–5):
    <input type="number" min="1" max="5" id="productivity">
  </label>
  <br><br>
  <button onclick="saveLog()">Save Today</button>
</div>

<div class="charts">
  <h2>Analytics</h2>
  <canvas id="goalChart"></canvas>
  <br><br>
  <canvas id="productivityChart"></canvas>
</div>

<script>
  const goals = [
    "Gate",
    "Job Apply",
    "AI Agents",
    "AI Research",
    "C++",
    "Kaggle",
    "Backlogs",
    "DSA Patterns"
  ];

  let currentGoal = "";

  function spin() {
    const spinner = document.getElementById("spinner");
    const randomIndex = Math.floor(Math.random() * goals.length);
    currentGoal = goals[randomIndex];

    const rotation = Math.floor(Math.random() * 2000) + 1000;
    spinner.style.transform = `rotate(${rotation}deg)`;

    setTimeout(() => {
      spinner.innerText = currentGoal;
      document.getElementById("selectedGoal").innerText = "Goal: " + currentGoal;
    }, 3000);
  }

  function saveLog() {
    if (!currentGoal) {
      alert("Spin first");
      return;
    }

    const productivity = document.getElementById("productivity").value;
    if (productivity < 1 || productivity > 5) {
      alert("Productivity must be 1–5");
      return;
    }

    const logs = JSON.parse(localStorage.getItem("dailyLogs")) || [];

    logs.push({
      date: new Date().toISOString().slice(0, 10),
      goal: currentGoal,
      productivity: Number(productivity)
    });

    localStorage.setItem("dailyLogs", JSON.stringify(logs));
    alert("Saved");

    renderCharts();
  }

  function renderCharts() {
    const logs = JSON.parse(localStorage.getItem("dailyLogs")) || [];

    const goalCount = {};
    const productivityByDate = {};

    logs.forEach(log => {
      goalCount[log.goal] = (goalCount[log.goal] || 0) + 1;
      productivityByDate[log.date] = log.productivity;
    });

    // Goal chart
    const goalCtx = document.getElementById("goalChart").getContext("2d");
    if (window.goalChart) window.goalChart.destroy();

    window.goalChart = new Chart(goalCtx, {
      type: "bar",
      data: {
        labels: Object.keys(goalCount),
        datasets: [{
          label: "Sessions per Goal",
          data: Object.values(goalCount)
        }]
      }
    });

    // Productivity chart
    const prodCtx = document.getElementById("productivityChart").getContext("2d");
    if (window.productivityChart) window.productivityChart.destroy();

    window.productivityChart = new Chart(prodCtx, {
      type: "line",
      data: {
        labels: Object.keys(productivityByDate),
        datasets: [{
          label: "Daily Productivity",
          data: Object.values(productivityByDate),
          fill: false
        }]
      }
    });
  }

  renderCharts();
</script>

</body>
</html>
